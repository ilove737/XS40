C51 COMPILER V9.56.0.0   WS2812                                                            11/20/2019 19:33:06 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE WS2812
OBJECT MODULE PLACED IN .\Output\ws2812.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Code\ws2812.C OPTIMIZE(8,SPEED) BROWSE INCDIR(..\..\Include) DEFINE(FOSC
                    -_160000) DEBUG OBJECTEXTEND PRINT(.\LST\ws2812.lst) OBJECT(.\Output\ws2812.obj)

line level    source

   1          #include "N76E003.h"
   2          #include "SFR_Macro.h"
   3          #include "Function_define.h"
   4          #include "Common.h"
   5          #include "Delay.h"
   6          
   7          #define DI P00
   8          
   9          int SNUM=80;
  10          //------------------------------------------------------------------------------
  11          //å­ç¨‹åºåç§°:IO_Init(void)
  12          //åŠŸèƒ½ï¼šç«¯å£åˆå§‹åŒ–
  13          //------------------------------------------------------------------------------
  14          void IO_Init(void) { ; }
  15          
  16          //------------------------------------------------------------------------------
  17          //å­ç¨‹åºåç§°:ResetDateFlow(void)
  18          //åŠŸèƒ½ï¼šå¤ä½ï¼Œä¸ºä¸‹ä¸€æ¬¡å‘é€åšå‡†å¤‡ï¼Œ
  19          //è¯´æ˜ï¼šå°†DIç½®ä½ä¸º0åï¼Œå»¶æ—¶çº¦65us
  20          //------------------------------------------------------------------------------
  21          void ResetDataFlow(void)
  22          {
  23   1          unsigned char i, j;
  24   1          DI = 0;     //DIç½®ä¸º0åï¼Œå»¶æ—¶50usä»¥ä¸Šï¼Œå®ç°å¸§å¤ä½
  25   1          for (i = 0; i < 15; i++)    //æ­¤å¤„33Mhzæ—¶å»¶æ—¶65us
  26   1              {
  27   2                  for (j = 0; j < 20; j++)
  28   2                  {
  29   3                      ;
  30   3                  }
  31   2              }
  32   1      }
  33          
  34          //------------------------------------------------------------------------------
  35          //å­ç¨‹åºåç§°:SendOnePix(unsignedchar*ptr)
  36          //åŠŸèƒ½ï¼šå‘é€ä¸€ä¸ªåƒç´ ç‚¹çš„24bitæ•°æ®
  37          //å‚æ•°ï¼šæ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ­¤å‡½æ•°ä¼šå°†æ­¤æŒ‡é’ˆæŒ‡å‘çš„åœ°å€çš„è¿ç»­çš„ä¸‰ä¸ªByteç
             -š„æ•°æ®å‘é€
  38          //è¯´æ˜ï¼šåœ¨ä¸»å‡½æ•°ä¸­ç›´æ¥è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œåœ¨æ•´ä¸ªå¸§å‘é€å¼€å§‹å‰éœ€è¦å…ˆæ‰§è¡ŒResetDataFl
             -ow()
  39          //Â æ•°æ®æ˜¯æŒ‰å½’é›¶ç çš„æ–¹å¼å‘é€ï¼Œé€Ÿç‡ä¸º800KBPS
  40          void SendOnePix(unsigned char *ptr)
  41          {
  42   1          unsigned char i, j;
  43   1          unsigned char temp;
  44   1          for (j = 0; j < 3; j++)
  45   1          {
  46   2              temp = ptr[j];
  47   2              for (i = 0; i < 8; i++)
  48   2              {
  49   3                  if (temp & 0x80) //ä»é«˜ä½å¼€å§‹å‘é€
  50   3                  {
  51   4                      DI = 1;  //å‘é€â€œ1â€ç 
  52   4                      _nop_(); //ä¸å¯çœç•¥çš„nop(),å»¶æ—¶æŒ‡å®šæ—¶é—´ä½œâ½¤ï¼Œæ™¶æŒ¯é¢‘ç‡33MHz
C51 COMPILER V9.56.0.0   WS2812                                                            11/20/2019 19:33:06 PAGE 2   

  53   4                      _nop_();
  54   4                      _nop_();
  55   4                      _nop_();
  56   4                      _nop_();
  57   4                      _nop_();
  58   4                      _nop_();
  59   4                      _nop_();
  60   4                      _nop_();
  61   4                      _nop_();
  62   4                      _nop_();
  63   4                      _nop_();
  64   4                      _nop_();
  65   4                      _nop_();
  66   4                      _nop_();
  67   4                      _nop_();
  68   4                      _nop_();
  69   4                      _nop_();
  70   4                      _nop_();
  71   4                      _nop_();
  72   4                      DI = 0;
  73   4                      _nop_();
  74   4                      _nop_();
  75   4                      _nop_();
  76   4                      _nop_();
  77   4                      _nop_();
  78   4                      _nop_();
  79   4                      _nop_();
  80   4                      _nop_();
  81   4                      _nop_();
  82   4                      _nop_();
  83   4                      _nop_();
  84   4                      _nop_();
  85   4                      _nop_();
  86   4                      _nop_();
  87   4                  }
  88   3                  else //å‘é€â€œ0â€ç 
  89   3                  {
  90   4                      DI = 1;
  91   4                      _nop_();
  92   4                      _nop_();
  93   4                      _nop_();
  94   4                      _nop_();
  95   4                      _nop_();
  96   4                      _nop_();
  97   4                      _nop_();
  98   4                      DI = 0;
  99   4                      _nop_();
 100   4                      _nop_();
 101   4                      _nop_();
 102   4                      _nop_();
 103   4                      _nop_();
 104   4                      _nop_();
 105   4                      _nop_();
 106   4                      _nop_();
 107   4                      _nop_();
 108   4                      _nop_();
 109   4                      _nop_();
 110   4                      _nop_();
 111   4                      _nop_();
 112   4                      _nop_();
 113   4                      _nop_();
 114   4                      _nop_();
C51 COMPILER V9.56.0.0   WS2812                                                            11/20/2019 19:33:06 PAGE 3   

 115   4                      _nop_();
 116   4                      _nop_();
 117   4                  }
 118   3                  temp = (temp << 1); //å·¦ç§»ä½
 119   3              }
 120   2          }
 121   1      }
 122          
 123          //------------------------------------------------------------------------------
 124          //â¼¦ç¨‹åºåç§°:SendOneFrame(unsignedchar*ptr)//åŠŸèƒ½ï¼šå‘é€â¼€å¸§æ•°æ®ï¼ˆå³å‘é€æ•´ä¸ªæ•°ç»„çš„æ•
             -°æ®ï¼‰
 125          //å‚æ•°ï¼šæ¥æ”¶çš„å‚æ•°æ˜¯â¼€ä¸ªæŒ‡é’ˆï¼Œæ­¤å‡½æ•°ä¼šå°†æ­¤æŒ‡é’ˆæŒ‡å‘çš„åœ°å€çš„æ•´ä¸ªæ•°ç»„çš„æ•°æ
             -®å‘é€
 126          //------------------------------------------------------------------------------
 127          void SendOneFrame(unsigned char *ptr)
 128          {
 129   1          unsigned char k;
 130   1          ResetDataFlow();    //å‘é€å¸§å¤ä½ä¿¡å·
 131   1              for (k = 0; k < SNUM; k++)
 132   1          //å‘é€ä¸€å¸§æ•°æ®ï¼ŒSNUMæ˜¯æ¿ä¸ŠLEDçš„ä¸ªæ•°
 133   1          {
 134   2              SendOnePix(&ptr[(3 * k)]);
 135   2          }
 136   1          ResetDataFlow();    //å‘é€å¸§å¤ä½ä¿¡å·
 137   1      }
 138          
 139          //------------------------------------------------------------------------------
 140          //åŠŸèƒ½ï¼šç›¸åŒé¢œâ¾Šçš„ç‚¹å‘é€cntæ¬¡
 141          //å‚æ•°ï¼šæ¥æ”¶çš„å‚æ•°æ˜¯â¼€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘åƒç´ ç‚¹é¢œâ¾Šæ•°ç»„ï¼Œcntä¼ é€’å‘é€ä¸ªæ•°
 142          //------------------------------------------------------------------------------
 143          void SendSameColor(unsigned char *ptr, unsigned char cnt)
 144          {
 145   1          unsigned char k;
 146   1          ResetDataFlow();    //å‘é€å¸§å¤ä½ä¿¡å·
 147   1          for (k = 0; k < cnt; k++)   //å‘é€ä¸€å¸§æ•°æ®ï¼ŒSNUMæ˜¯æ¿ä¸ŠLEDçš„ä¸ªæ•°
 148   1          {
 149   2              SendOnePix(&ptr[0]);
 150   2          }
 151   1          ResetDataFlow();    //å‘é€å¸§å¤ä½ä¿¡å·
 152   1      }
 153          
 154          //------------------------------------------------------------------------------
 155          //â¼¦ç¨‹åºåç§°:SendOneFrameFrom(unsignedchari,unsignedchar*ptr)
 156          //åŠŸèƒ½ï¼šä»æŒ‡å®šçš„åƒç´ ç‚¹å¼€å§‹å‘é€â¼€å¸§æ•°æ®ï¼ˆå³å‘é€æ•´ä¸ªæ•°ç»„çš„æ•°æ®ï¼‰
 157          //å‚æ•°ï¼šæ¥æ”¶çš„å‚æ•°æ˜¯â¼€ä¸ªæŒ‡é’ˆï¼Œæ­¤å‡½æ•°ä¼šå°†æ­¤æŒ‡é’ˆæŒ‡å‘çš„åœ°å€çš„æ•´å¸§æ•°æ®å‘é€
 158          //Â i:æŠŠæ•°ç»„çš„ç¬¬0ä¸ªåƒç´ æ•°æ®å‘é€åˆ°ç¬¬iä¸ªåƒç´ ç‚¹ï¼ˆç¬¬0ä¸ªåƒç´ æ˜¯æ¿ä¸Šæ ‡å·ä¸º01çš„åƒç´
             - ï¼‰
 159          //è¯´æ˜ï¼šå³åŸæœ¬å¯¹åº”ç¬¬â¼€ä¸ªåƒç´ çš„æ•°æ®ä¼šå‘é€åˆ°ç¬¬iä¸ªåƒç´ ç‚¹ï¼ˆLEDï¼‰ä¸Š
 160          //------------------------------------------------------------------------------
 161          void SendOneFrameFrom(unsigned char i, unsigned char *ptr)
 162          {
 163   1          unsigned char k;
 164   1          ResetDataFlow();    //å‘é€å¸§å¤ä½ä¿¡å·
 165   1          for (k = (SNUM - i); k < SNUM; k++) //å‘é€ä¸€å¸§æ•°æ®
 166   1          {
 167   2              SendOnePix(&ptr[(3 * k)]);
 168   2          }
 169   1          {
 170   2              SendOnePix(&ptr[(3 * k)]);
 171   2          }
 172   1          ResetDataFlow();
 173   1          //å‘é€å¸§å¤ä½ä¿¡å·
C51 COMPILER V9.56.0.0   WS2812                                                            11/20/2019 19:33:06 PAGE 4   

 174   1      }
 175          //------------------------------------------------------------------------------
 176          //â¼¦ç¨‹åºåç§°:SendOneFrameSince(unsignedchari,unsignedchar*ptr)
 177          //åŠŸèƒ½ï¼šä»ç¬¬iä¸ªåƒç´ ç‚¹çš„æ•°æ®å¼€å§‹å‘é€â¼€å¸§æ•°æ®ï¼ˆå³å‘é€æ•´ä¸ªæ•°ç»„çš„æ•°æ®ï¼‰
 178          //å‚æ•°ï¼šæ¥æ”¶çš„å‚æ•°æ˜¯â¼€ä¸ªæŒ‡é’ˆï¼Œæ­¤å‡½æ•°ä¼šå°†æ­¤æŒ‡é’ˆæŒ‡å‘çš„åœ°å€çš„æ•´å¸§æ•°æ®å‘é€
 179          //Â i:æŠŠæ•°ç»„çš„ç¬¬iä¸ªåƒç´ æ•°æ®å‘é€åˆ°ç¬¬1ä¸ªåƒç´ ç‚¹
 180          //è¯´æ˜ï¼šå³åŸæœ¬å¯¹åº”ç¬¬iåƒç´ çš„æ•°æ®ä¼šå‘é€åˆ°ç¬¬1ä¸ªåƒç´ ç‚¹ï¼ˆLEDï¼‰ä¸Šï¼Œç¬¬i+1ä¸ªåƒç´ ç‚¹
             -çš„æ•°æ®
 181          //Â å‘é€åˆ°ç¬¬2ä¸ªåƒç´ ä¸Š
 182          //------------------------------------------------------------------------------
 183          void SendOneFrameSince(unsigned char i, unsigned char *ptr)
 184          {
 185   1          unsigned char k;
 186   1          ResetDataFlow();           //å‘é€å¸§å¤ä½ä¿¡å·
 187   1          for (k = i; k < SNUM; k++) //å‘é€â¼€å¸§æ•°æ®
 188   1          {
 189   2              SendOnePix(&ptr[(3 * k)]);
 190   2          }
 191   1          for (k = 0; k < i; k++)
 192   1          {
 193   2              SendOnePix(&ptr[(3 * k)]);
 194   2          }
 195   1          ResetDataFlow(); //å‘é€å¸§å¤ä½ä¿¡å·
 196   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    349    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2      20
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
