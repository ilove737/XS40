C51 COMPILER V9.56.0.0   PCF8563                                                           11/20/2019 19:33:06 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE PCF8563
OBJECT MODULE PLACED IN .\Output\PCF8563.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Code\PCF8563.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\..\Include) DEFINE(FOS
                    -C_160000) DEBUG OBJECTEXTEND PRINT(.\LST\PCF8563.lst) OBJECT(.\Output\PCF8563.obj)

line level    source

   1          /********************I2C************************************/
   2          #define I2C_SDA_LOW()
   3          #define I2C_SCL_LOW()
   4          #define I2C_SDA_HIGH()
   5          #define I2C_SCL_HIGH()
   6          #define I2C_SDA_Read()
   7          
   8          static void I2C_Delay(void)
   9          {
  10   1          //å®žçŽ°å»¶æ—¶4us
  11   1      }
  12          
  13          static void I2C_Start(void)
  14          {
  15   1          I2C_SDA_HIGH();
  16   1          I2C_SCL_HIGH();
  17   1          I2C_Delay();
  18   1          I2C_SDA_LOW();
  19   1          I2C_Delay();
  20   1          I2C_SCL_LOW();
  21   1          I2C_Delay();
  22   1      }
  23          
  24          static void I2C_Stop()
  25          {
  26   1          I2C_SDA_LOW();
  27   1          I2C_SCL_HIGH();
  28   1          I2C_Delay();
  29   1          I2C_SDA_HIGH();
  30   1          I2C_Delay();
  31   1      }
  32          
  33          static unsigned char I2C_WaitAck(void)
  34          {
  35   1          I2C_SDA_HIGH();
  36   1          I2C_SCL_HIGH();
  37   1          I2C_Delay();
  38   1      //    if ( I2C_SDA_Read() ){
  39   1      //              return 1;
  40   1      //      }
  41   1          I2C_SCL_LOW();
  42   1          I2C_Delay();
  43   1          return 0;
  44   1      }
  45          
  46          static void I2C_SendAck(void)
  47          {
  48   1          I2C_SDA_LOW();
  49   1          I2C_Delay();
  50   1          I2C_SCL_HIGH();
  51   1          I2C_Delay();
  52   1          I2C_SCL_LOW();
  53   1          I2C_Delay();
  54   1      }
C51 COMPILER V9.56.0.0   PCF8563                                                           11/20/2019 19:33:06 PAGE 2   

  55          
  56          static void I2C_SendNoAck(void)
  57          {
  58   1          I2C_SDA_HIGH();
  59   1          I2C_Delay();   
  60   1          I2C_SCL_HIGH();
  61   1          I2C_Delay();
  62   1          I2C_SCL_LOW();
  63   1          I2C_Delay();
  64   1      }
  65          
  66          static void I2C_SendByte(unsigned char Byte)
  67          {
  68   1          unsigned char Cnt;
  69   1          for(Cnt=0;Cnt<8;Cnt++)
  70   1          {
  71   2              if(Byte&0x80)
  72   2              {
  73   3                  I2C_SDA_HIGH();
  74   3              }
  75   2              else
  76   2              {
  77   3                  I2C_SDA_LOW();
  78   3              }
  79   2              Byte<<=1;
  80   2              I2C_Delay();
  81   2              I2C_SCL_HIGH();
  82   2              I2C_Delay();
  83   2              I2C_SCL_LOW();
  84   2              I2C_Delay();
  85   2          }
  86   1      }
  87          
  88          static unsigned char I2C_ReceiveByte(void)
  89          {
  90   1          unsigned char Cnt,Byte=0;
  91   1          I2C_SDA_HIGH();
  92   1          for(Cnt=0;Cnt<8;Cnt++)
  93   1          {
  94   2              Byte<<=1;
  95   2              I2C_SCL_HIGH();
  96   2              I2C_Delay();
  97   2      //        if(I2C_SDA_Read())
  98   2      //            Byte++;
  99   2              I2C_Delay();
 100   2              I2C_SCL_LOW();
 101   2              I2C_Delay();
 102   2          }
 103   1          return Byte;
 104   1      }
 105          
 106          
 107          /****************************PCF8563**********************************/
 108          /*
 109          PCF8563æœ‰16ä¸ª8ä½çš„å¯„å­˜å™¨
 110          å¯„å­˜å™¨åœ°å€(16è¿›åˆ¶):
 111          00:æŽ§åˆ¶çŠ¶æ€å¯„å­˜å™¨1
 112          01:æŽ§åˆ¶çŠ¶æ€å¯„å­˜å™¨2
 113          02:ç§’å¯„å­˜å™¨(BCDæ•°æ®æ ¼å¼,å…¶ä¸­æœ€é«˜ä½è¡¨ç¤ºæ•°æ®çš„å‡†ç¡®æ€§0:æ•°æ®å‡†ç¡®,1:æ•°æ®å¯èƒ½æ˜¯é”™
             -çš„,[6:0]æ‰æ˜¯æ•°æ®å†…å®¹)
 114          03:åˆ†é’Ÿå¯„å­˜å™¨(BCDæ•°æ®æ ¼å¼,æœ€é«˜ä½æ— æ•ˆ)
 115          04:å°æ—¶å¯„å­˜å™¨(BCDæ•°æ®æ ¼å¼,åªæœ‰[5:0]æ‰æ˜¯æœ‰æ•ˆæ•°æ®)
C51 COMPILER V9.56.0.0   PCF8563                                                           11/20/2019 19:33:06 PAGE 3   

 116          05:æ—¥æœŸå¯„å­˜å™¨(BCDæ•°æ®æ ¼å¼,åªæœ‰[5:0]æ‰æ˜¯æœ‰æ•ˆæ•°æ®)
 117          06:æ˜ŸæœŸå¯„å­˜å™¨([2:0]æ‰æ˜¯æœ‰æ•ˆæ•°æ® ä¿å­˜çš„æ˜¯0~6,çš„äºŒè¿›åˆ¶å€¼éžBCDç¼–ç )
 118          07:æœˆ/ä¸–çºªå¯„å­˜å™¨(æœ€é«˜ä½ä¸º1æ—¶è¡¨ç¤ºçŽ°åœ¨æ˜¯20ä¸–çºª19xxå¹´,ä¸º0æ—¶è¡¨ç¤º21ä¸–çºª20xxå¹´,[4:0]ä½
             -æ˜¯BCDæ ¼å¼ä¿å­˜æœˆä»½ å…¶ä½™ä½æ— æ•ˆ)
 119          08:å¹´å¯„å­˜å™¨(å…¨éƒ¨éƒ½æ˜¯æœ‰æ•ˆæ•°æ®BCDæ•°æ®æ ¼å¼ä¿å­˜19xx/20xxçš„xxçš„å€¼)
 120          09:åˆ†é’ŸæŠ¥è­¦å€¼//ä»¥ä¸‹çš„å¯„å­˜å™¨æœªç”¨åˆ°
 121          0a:å°æ—¶æŠ¥è­¦
 122          0b:æ—¥æœŸæŠ¥è­¦
 123          0c:æ˜ŸæœŸæŠ¥è­¦
 124          0d:
 125          0e:
 126          0f:
 127          */
 128          
 129          #define PCF8563_Read    0xa3
 130          #define PCF8563_Write    0xa2
 131          unsigned char PCF8563_SendByte(unsigned char Reg,unsigned char RegVal)
 132          {
 133   1          //Reg æ˜¯å¯„å­˜å™¨çš„åœ°å€
 134   1          //RegVal æ˜¯è¦å†™è¿›å¯„å­˜å™¨çš„å€¼
 135   1          //0 æˆåŠŸ 1  å¤±è´¥
 136   1          I2C_Start();
 137   1          I2C_SendByte(PCF8563_Write);
 138   1          if(I2C_WaitAck())
 139   1              return 1;
 140   1          I2C_SendByte(Reg);
 141   1          if(I2C_WaitAck())
 142   1              return 1;
 143   1          I2C_SendByte(RegVal);
 144   1          if(I2C_WaitAck())
 145   1              return 1;
 146   1          I2C_Stop();
 147   1          return 0;
 148   1      }
 149          
 150          unsigned char PCF8563_ReceiveByte(unsigned char Reg,unsigned char *RegVal)
 151          {
 152   1          //Reg è¦è¯»çš„å¯„å­˜å™¨çš„åœ°å€
 153   1          //RegVal è¯»å‡ºæ¥çš„æ•°æ®ä¿å­˜çš„åœ°å€
 154   1          // 0 æˆåŠŸ  1å¤±è´¥
 155   1          I2C_Start();
 156   1          I2C_SendByte(PCF8563_Write);
 157   1          if(I2C_WaitAck())
 158   1              return 1;
 159   1          I2C_SendByte(Reg);
 160   1          if(I2C_WaitAck())
 161   1              return 1;
 162   1          I2C_Start();
 163   1          I2C_SendByte(PCF8563_Read);
 164   1          if(I2C_WaitAck())
 165   1              return 1;
 166   1          *RegVal=I2C_ReceiveByte();
 167   1          I2C_SendNoAck();
 168   1          I2C_Stop();
 169   1          return 0;
 170   1      }
 171          
 172          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    185    ----
C51 COMPILER V9.56.0.0   PCF8563                                                           11/20/2019 19:33:06 PAGE 4   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
