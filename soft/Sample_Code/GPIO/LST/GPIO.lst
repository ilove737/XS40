C51 COMPILER V9.56.0.0   GPIO                                                              03/12/2020 21:38:45 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE GPIO
OBJECT MODULE PLACED IN .\Output\GPIO.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Code\GPIO.C OPTIMIZE(8,SPEED) BROWSE INCDIR(..\..\Include) DEFINE(FOSC_1
                    -60000) DEBUG OBJECTEXTEND PRINT(.\LST\GPIO.lst) OBJECT(.\Output\GPIO.obj)

line level    source

   1          #include "N76E003.h"
   2          #include "SFR_Macro.h"
   3          #include "Function_define.h"
   4          #include "Common.h"
   5          #include "Delay.h"
   6          #include <string.h>
   7          #include "keyScanCode.h"
   8          
   9          #define row1 P00
  10          #define row2 P01
  11          #define row3 P02
  12          #define row4 P03
  13          #define row5 P04
  14          
  15          #define col1 P10
  16          #define col2 P11
  17          #define col3 P12
  18          #define col4 P13
  19          #define col5 P14
  20          #define col6 P15
  21          #define col7 P16
  22          #define col8 P17
  23          
  24          unsigned int i;
  25          unsigned char xdata beforeAllKey[5]; // 40个位，保存上一次所有40个建的状态
  26          unsigned char xdata allKey[5];           // 40个位，保存当前所有40个建的状态
  27          
  28          unsigned char xdata HIDFrames[8];
  29          
  30          UINT8 tttt = 0;
  31          UINT16 TH1_INIT = 1333;
  32          
  33          void makeHIDFrames(void)
  34          {
  35   1              if (allKey[0] == 0 && allKey[1] == 0 && allKey[2] == 0 && allKey[3] == 0 && allKey[4] == 0)
  36   1              {
  37   2                      for (i = 0; i < 8; i++)
  38   2                      {
  39   3                              Send_Data_To_UART0(0x00);
  40   3                      }
  41   2              }
  42   1              else
  43   1              {
  44   2                      Send_Data_To_UART0(0x01);
  45   2              }
  46   1      }
  47          
  48          // 系统时钟      16000 / 16000000 = 0.001s
  49          // 系统时钟1/12  1333  / 1333333  = 0.001s
  50          void Timer1_ISR(void) interrupt 3 //interrupt address is 0x001B
  51          {
  52   1              TH1 = (65536 - TH1_INIT) / 256;
  53   1              TL1 = (65536 - TH1_INIT) % 256;
  54   1      
C51 COMPILER V9.56.0.0   GPIO                                                              03/12/2020 21:38:45 PAGE 2   

  55   1              // row1到row5依次拉低
  56   1              P0 = 0xFF;
  57   1              if (tttt == 5) //所有键扫描完成
  58   1              {
  59   2                      tttt = 0;
  60   2                      if (memcmp(beforeAllKey, allKey, 5) != 0)
  61   2                      {
  62   3                              memcpy(beforeAllKey, allKey, 5);
  63   3      
  64   3                              makeHIDFrames();
  65   3                              // Send_Data_To_UART0(allKey[i]);
  66   3                      }
  67   2              }
  68   1              else
  69   1              {
  70   2                      if (tttt == 0)
  71   2                              P00 = 0;
  72   2                      if (tttt == 1)
  73   2                              P01 = 0;
  74   2                      if (tttt == 2)
  75   2                              P02 = 0;
  76   2                      if (tttt == 3)
  77   2                              P03 = 0;
  78   2                      if (tttt == 4)
  79   2                              P04 = 0;
  80   2      
  81   2                      allKey[tttt] = ~P1;
  82   2      
  83   2                      tttt++;
  84   2              }
  85   1      }
  86          
  87          void main(void)
  88          {
  89   1              ///////////////////////////////////WDT///////////////////////////////////////
  90   1              TA = 0xAA;
  91   1              TA = 0x55;
  92   1              WDCON = 0x07; //Setting WDT prescale
  93   1              set_WDTR;        //WDT run
  94   1              set_WDCLR;      //Clear WDT timer
  95   1              set_EWDT;
  96   1              EA = 1;
  97   1              //set_WIDPD;
  98   1              /////////////////////////////////////////////////////////////////////////////
  99   1      
 100   1              Set_All_GPIO_Quasi_Mode;
 101   1      
 102   1              P00_PushPull_Mode;
 103   1              P01_PushPull_Mode;
 104   1              P02_PushPull_Mode;
 105   1              P03_PushPull_Mode;
 106   1              P04_PushPull_Mode;
 107   1      
 108   1              TIMER1_MODE1_ENABLE;
 109   1              // set_T1M;
 110   1              TH1 = (65536 - TH1_INIT) / 256;
 111   1              TL1 = (65536 - TH1_INIT) % 256;
 112   1              set_ET1; //enable Timer1 interrupt
 113   1              set_EA;  //enable interrupts
 114   1              set_TR1; //Timer1 run
 115   1      
 116   1              InitialUART0_Timer3(115200);
C51 COMPILER V9.56.0.0   GPIO                                                              03/12/2020 21:38:45 PAGE 3   

 117   1              // Enable_ADC_AIN1; // Enable AIN0 as ADC input, Find in "Function_define.h" - "ADC INIT"
 118   1              // Enable_ADC_AIN7;
 119   1      
 120   1              while (1)
 121   1              {
 122   2                      set_WDCLR; // 喂狗
 123   2              }
 124   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    502    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     18    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
